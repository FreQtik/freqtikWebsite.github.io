<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>UFO Clicker Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      color: white;
      overflow: hidden;
      font-family: sans-serif;
    }
    canvas {
      display: block;
      background: black;
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      z-index: 10;
    }
    #stats {
      margin-top: 10px;
    }
    #endScreen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.95);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: white;
      z-index: 20;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="ui">
    <div>Time: <span id="timeLeft">15</span>s</div>
    <div>Score: <span id="score">0</span></div>
    <div id="stats"></div>
  </div>

  <div id="endScreen">
    <h1>Game Over</h1>
    <canvas id="chartCanvas" width="400" height="200"></canvas>
    <p id="summary"></p>
    <button onclick="startGame()">Restart</button>
    <button onclick="location.reload()">Quit</button>
  </div>

  <audio id="clickSound" src="https://cdn.pixabay.com/audio/2021/08/04/audio_749f59f47f.mp3"></audio>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let W = canvas.width = window.innerWidth;
    let H = canvas.height = window.innerHeight;

    let enemies = [];
    let score = 0;
    let timeLeft = 15;
    let clickCount = 0;
    let failCount = 0;
    let reactions = [];
    let gameRunning = false;
    let gameStart = 0;

    const ufoImages = {
      basic: new Image(),
      sine: new Image(),
      tangent: new Image()
    };
    ufoImages.basic.src = "ufo_basic.png";
    ufoImages.sine.src = "ufo_sine.png";
    ufoImages.tangent.src = "ufo_tangent.png";

    const clickSound = document.getElementById("clickSound");

    class Enemy {
      constructor(type) {
        this.type = type;
        this.x = Math.random() * (W - 100);
        this.y = Math.random() * (H - 100);
        this.radius = 40;
        this.speed = 1 + Math.random() * 2;
        this.hitPoints = type === "basic" ? 1 : 2;
        this.angle = 0;
        this.spawnTime = Date.now();
      }

      update() {
        this.angle += 0.03;
        switch (this.type) {
          case "sine":
            this.y += Math.sin(this.angle) * 2 + this.speed;
            this.x += Math.cos(this.angle * 0.5) * 1.5;
            break;
          case "tangent":
            this.y += Math.tan(this.angle * 0.1) * 0.5;
            this.x += Math.cos(this.angle) * 3;
            break;
          default:
            this.y += this.speed;
        }

        if (this.y > H) {
          failCount++;
          this.respawn();
        }
      }

      draw() {
        const img = ufoImages[this.type];
        ctx.drawImage(img, this.x, this.y, 80, 80);
      }

      isHit(mx, my) {
        return mx >= this.x && mx <= this.x + 80 && my >= this.y && my <= this.y + 80;
      }

      respawn() {
        this.x = Math.random() * (W - 100);
        this.y = -80;
        this.hitPoints = this.type === "basic" ? 1 : 2;
        this.spawnTime = Date.now();
      }
    }

    function spawnEnemy() {
      const types = ["basic", "sine", "tangent"];
      const type = types[Math.floor(Math.random() * types.length)];
      enemies.push(new Enemy(type));
    }

    function gameLoop() {
      if (!gameRunning) return;

      ctx.clearRect(0, 0, W, H);
      enemies.forEach(e => {
        e.update();
        e.draw();
      });

      requestAnimationFrame(gameLoop);
    }

    function updateUI() {
      document.getElementById("timeLeft").innerText = timeLeft;
      document.getElementById("score").innerText = score;
    }

    function handleClick(e) {
      if (!gameRunning) return;

      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      let hit = false;

      enemies.forEach(enemy => {
        if (enemy.isHit(mx, my)) {
          clickSound.currentTime = 0;
          clickSound.play();
          enemy.hitPoints--;
          hit = true;
          if (enemy.hitPoints <= 0) {
            score++;
            let reaction = Date.now() - enemy.spawnTime;
            reactions.push(reaction);
            enemy.respawn();
          }
        }
      });

      if (!hit) failCount++;
      clickCount++;
      updateUI();
    }

    canvas.addEventListener('click', handleClick);

    function startGame() {
      score = 0;
      timeLeft = 15;
      clickCount = 0;
      failCount = 0;
      reactions = [];
      enemies = [];
      for (let i = 0; i < 5; i++) spawnEnemy();
      document.getElementById("endScreen").style.display = "none";
      gameRunning = true;
      gameStart = Date.now();
      updateUI();
      gameLoop();

      let countdown = setInterval(() => {
        timeLeft--;
        updateUI();
        if (timeLeft <= 0) {
          clearInterval(countdown);
          gameRunning = false;
          showResults();
        }
      }, 1000);
    }

    function showResults() {
      document.getElementById("endScreen").style.display = "flex";
      const avg = reactions.reduce((a, b) => a + b, 0) / reactions.length || 0;
      document.getElementById("summary").innerText =
        `Final Score: ${score}\nClicks: ${clickCount}\nFails: ${failCount}\nAvg Reaction: ${Math.round(avg)}ms`;

      new Chart(document.getElementById('chartCanvas'), {
        type: 'line',
        data: {
          labels: reactions.map((_, i) => i + 1),
          datasets: [{
            label: "Reaction Time (ms)",
            data: reactions,
            borderColor: "lime",
            fill: false
          }]
        }
      });
    }

    startGame(); // auto-start
  </script>
</body>
</html>
