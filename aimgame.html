<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UFO Clicker</title>
  <style>
    body {
      margin: 0;
      background: black;
      overflow: hidden;
      color: white;
      font-family: sans-serif;
    }
    canvas {
      display: block;
    }
    #hud, #endScreen, #quitButton {
      position: absolute;
      z-index: 10;
    }
    #hud {
      top: 10px;
      left: 10px;
    }
    #quitButton {
      top: 10px;
      right: 10px;
      background: red;
      padding: 6px 12px;
      border: none;
      color: white;
      cursor: pointer;
    }
    #endScreen {
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.85);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    #chartContainer {
      width: 90%;
      max-width: 500px;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="hud">
    Time: <span id="time">0</span> | UFOs: <span id="ufoCount">0</span> | Clicks: <span id="clicks">0</span>
  </div>
  <button id="quitButton" onclick="window.location.href='index.html'">Quit</button>
  <div id="endScreen">
    <h2>Game Over</h2>
    <div>UFOs clicked: <span id="finalCount"></span></div>
    <div>Avg APM: <span id="finalAPM"></span></div>
    <div>Failures: <span id="failCount"></span></div>
    <div id="chartContainer"><canvas id="reactionChart"></canvas></div>
    <button onclick="location.reload()">Restart</button>
    <button onclick="window.location.href='index.html'">Quit to Home</button>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const hud = {
      time: document.getElementById('time'),
      ufoCount: document.getElementById('ufoCount'),
      clicks: document.getElementById('clicks'),
    };
    const endScreen = document.getElementById('endScreen');
    const finalCount = document.getElementById('finalCount');
    const finalAPM = document.getElementById('finalAPM');
    const failCountEl = document.getElementById('failCount');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let ufos = [], clicks = 0, totalUFOs = 0, startTime = Date.now();
    let reactionTimes = [], failCount = 0, spawnInterval = 1500, ufoSpeed = 1;

    const ufoImages = [];
let imagesLoaded = 0;
const totalImages = 3; // Change this to match the number of UFO images you have

for (let i = 1; i <= totalImages; i++) {
  const img = new Image();
  img.src = `ufos/ufo${i}.png`; // âœ… This should match your folder structure
  img.onload = () => {
    imagesLoaded++;
    if (imagesLoaded === totalImages) {
      startGame(); // Start the game only when all images are loaded
    }
  };
  img.onerror = () => {
    console.error(`Failed to load image: ufos/ufo${i}.png`);
  };
  ufoImages.push(img);
}


    const clickSound = new Audio('https://actions.google.com/sounds/v1/cartoon/pop.ogg');

    class UFO {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.r = 32 + Math.random() * 20;
        this.hp = 1 + Math.floor(Math.random() * 3);
        this.spawnTime = Date.now();
        this.speed = ufoSpeed + Math.random();
        this.movePattern = Math.floor(Math.random() * 4);
        this.img = ufoImages[Math.floor(Math.random() * ufoImages.length)];
        this.angle = 0;
        this.id = performance.now();
      }

      move(t) {
        switch (this.movePattern) {
          case 0:
            this.x += this.speed;
            break;
          case 1:
            this.y += Math.sin(t / 200) * this.speed;
            this.x += Math.cos(t / 300) * this.speed;
            break;
          case 2:
            this.x += Math.tan(t / 1000) * this.speed * 0.5;
            this.y += this.speed;
            break;
          case 3:
            this.x += Math.cos(this.angle) * this.speed;
            this.y += Math.sin(this.angle) * this.speed;
            this.angle += 0.05;
            break;
        }
        if (this.x < -50 || this.x > canvas.width + 50 || this.y < -50 || this.y > canvas.height + 50) {
          ufos = ufos.filter(u => u.id !== this.id);
          failCount++;
        }
      }

      draw() {
        ctx.drawImage(this.img, this.x - this.r/2, this.y - this.r/2, this.r, this.r);
      }

      isClicked(mx, my) {
        return Math.hypot(mx - this.x, my - this.y) < this.r;
      }
    }

    function spawnUFO() {
      ufos.push(new UFO());
      totalUFOs++;
    }

    function handleClick(e) {
      const mx = e.touches ? e.touches[0].clientX : e.clientX;
      const my = e.touches ? e.touches[0].clientY : e.clientY;
      let clicked = false;

      ufos.forEach((ufo, i) => {
        if (ufo.isClicked(mx, my)) {
          ufo.hp--;
          clicked = true;
          if (ufo.hp <= 0) {
            reactionTimes.push(Date.now() - ufo.spawnTime);
            ufos.splice(i, 1);
            clicks++;
            clickSound.play();
          }
        }
      });

      if (!clicked) {
        failCount++;
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const now = Date.now();
      ufos.forEach(ufo => {
        ufo.move(now);
        ufo.draw();
      });

      const elapsed = Math.floor((now - startTime) / 1000);
      hud.time.textContent = elapsed;
      hud.ufoCount.textContent = totalUFOs;
      hud.clicks.textContent = clicks;

      if (elapsed % 60 === 0 && elapsed !== 0 && !ufos.some(u => u.hp > 5)) {
        let boss = new UFO();
        boss.hp = 10 + Math.floor(elapsed / 10);
        boss.r = 64;
        boss.img = ufoImages[0];
        ufos.push(boss);
      }

      requestAnimationFrame(draw);
    }

    function gameOver() {
      endScreen.style.display = 'flex';
      finalCount.textContent = clicks;
      finalAPM.textContent = Math.round((clicks / ((Date.now() - startTime) / 60000)) * 100) / 100;
      failCountEl.textContent = failCount;

      const ctxChart = document.getElementById('reactionChart').getContext('2d');
      new Chart(ctxChart, {
        type: 'line',
        data: {
          labels: reactionTimes.map((_, i) => i + 1),
          datasets: [{
            label: 'Reaction Time (ms)',
            data: reactionTimes,
            borderColor: 'lime',
            tension: 0.3
          }]
        }
      });
    }

    canvas.addEventListener('click', handleClick);
    canvas.addEventListener('touchstart', handleClick);

    function startGame() {
  setInterval(spawnUFO, spawnInterval);
  setTimeout(gameOver, 90000); // 90 seconds
  draw();
}
  </script>
</body>
</html>
