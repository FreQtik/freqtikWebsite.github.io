<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sudoku Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    #sudoku-board {
      display: grid;
      grid-template-columns: repeat(9, 40px);
      grid-template-rows: repeat(9, 40px);
      gap: 3px;
      border: 3px solid #000; /* Outer border of the entire grid */
      background-color: #fff;
    }
    .cell {
      width: 40px;
      height: 40px;
      text-align: center;
      line-height: 40px;
      font-size: 18px;
      border: 1px solid #ccc;
      background-color: white;
    }
    .cell.selected {
      background-color: #f0f8ff;
    }
    .cell.readonly {
      background-color: #e0e0e0;
    }
    .block-3x3 {
      border-right: 3px solid #000;
      border-bottom: 3px solid #000;
    }
    #controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-left: 20px;
    }
    #controls button {
      margin: 5px;
      padding: 10px;
      font-size: 16px;
    }
    #score {
      margin-top: 20px;
    }
    #timer {
      margin-top: 10px;
    }
    #undo {
      margin-top: 10px;
    }
    #error-message {
      color: red;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <div id="sudoku-board"></div>
  <div id="controls">
    <div id="timer">Time: 00:00</div>
    <div id="score">Score: 0</div>
    <button id="reset">Reset</button>
    <button id="check">Check</button>
    <button id="undo">Undo</button>
    <button id="hint">?</button>
    <div id="error-message"></div>
  </div>

  <script>
    const board = document.getElementById('sudoku-board');
    const resetButton = document.getElementById('reset');
    const checkButton = document.getElementById('check');
    const undoButton = document.getElementById('undo');
    const hintButton = document.getElementById('hint');
    const timerDisplay = document.getElementById('timer');
    const scoreDisplay = document.getElementById('score');
    const errorMessage = document.getElementById('error-message');
    
    let boardData;
    let originalBoard;
    let currentBoard;
    let selectedCell = null;
    let gameStarted = false;
    let timerInterval;
    let startTime;
    let elapsedTime = 0;
    let score = 0;
    let moveHistory = [];
    let failedAttempts = 0;
    let difficulty = 'medium';  // Can be 'easy', 'medium', or 'hard'

    const solvedBoard = [
      [5, 3, 4, 6, 7, 8, 9, 1, 2],
      [6, 7, 2, 1, 9, 5, 3, 4, 8],
      [1, 9, 8, 3, 4, 2, 5, 6, 7],
      [8, 5, 9, 7, 6, 1, 4, 2, 3],
      [4, 2, 6, 8, 5, 3, 7, 9, 1],
      [7, 1, 3, 9, 2, 4, 8, 5, 6],
      [9, 6, 1, 5, 3, 7, 2, 8, 4],
      [2, 8, 7, 4, 1, 9, 6, 3, 5],
      [3, 4, 5, 2, 8, 6, 1, 7, 9]
    ];

    // Function to generate a new Sudoku puzzle based on the difficulty
    function generatePuzzle() {
      // For simplicity, we'll use a static solved board and create puzzles from it.
      boardData = JSON.parse(JSON.stringify(solvedBoard));  // Deep copy
      originalBoard = JSON.parse(JSON.stringify(solvedBoard));
      currentBoard = JSON.parse(JSON.stringify(solvedBoard));

      // Randomly remove numbers to create a puzzle
      let removeCount = difficulty === 'easy' ? 35 : difficulty === 'medium' ? 45 : 55;
      while (removeCount > 0) {
        let row = Math.floor(Math.random() * 9);
        let col = Math.floor(Math.random() * 9);
        if (boardData[row][col] !== 0) {
          boardData[row][col] = 0;
          removeCount--;
        }
      }

      renderBoard();
      gameStarted = true;
      failedAttempts = 0;
      elapsedTime = 0;
      moveHistory = [];
      startTime = Date.now();
      clearInterval(timerInterval);
      timerInterval = setInterval(updateTimer, 1000);
    }

    // Render the board to the UI
    function renderBoard() {
      board.innerHTML = '';
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          if (originalBoard[row][col] !== 0) {
            cell.classList.add('readonly');
          }
          if ((row % 3 === 2) && (col % 3 === 2)) {
            cell.classList.add('block-3x3');
          }
          cell.textContent = boardData[row][col] === 0 ? '' : boardData[row][col];
          cell.addEventListener('click', () => selectCell(row, col));
          board.appendChild(cell);
        }
      }
    }

    // Select a cell to highlight and allow input
    function selectCell(row, col) {
      if (originalBoard[row][col] !== 0) return;
      if (selectedCell) {
        selectedCell.classList.remove('selected');
      }
      selectedCell = board.children[row * 9 + col];
      selectedCell.classList.add('selected');
    }

    // Start the game
    generatePuzzle();

    // Update the timer
    function updateTimer() {
      elapsedTime = Math.floor((Date.now() - startTime) / 1000);
      let minutes = Math.floor(elapsedTime / 60);
      let seconds = elapsedTime % 60;
      timerDisplay.textContent = `Time: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    // Reset the game
    resetButton.addEventListener('click', generatePuzzle);

    // Check the current solution
    checkButton.addEventListener('click', checkSolution);

    // Undo the last move
    undoButton.addEventListener('click', undoMove);

    // Show a hint
    hintButton.addEventListener('click', showHint);

    // Check if the current board is solved correctly
    function checkSolution() {
      let isValid = true;
      for (let row = 0; row < 9; row++) {
        for (let col = 0; col < 9; col++) {
          if (boardData[row][col] !== originalBoard[row][col] && boardData[row][col] !== solvedBoard[row][col]) {
            isValid = false;
            break;
          }
        }
      }
      if (isValid) {
        alert('Congratulations! You solved the puzzle!');
        score += 100;
        scoreDisplay.textContent = `Score: ${score}`;
      } else {
        failedAttempts++;
        if (failedAttempts >= 3) {
          alert('Game over! You failed 3 times.');
          generatePuzzle();
        } else {
          errorMessage.textContent = `Incorrect solution. Attempt ${failedAttempts}/3.`;
        }
      }
    }

    // Undo the last move
    function undoMove() {
      if (moveHistory.length > 0) {
        const lastMove = moveHistory.pop();
        boardData[lastMove.row][lastMove.col] = lastMove.prevValue;
        renderBoard();
      }
    }

    // Show a hint (explain a technique)
    function showHint() {
      alert('Try using the process of elimination to narrow down possible values for each empty cell!');
    }
  </script>

</body>
</html>
