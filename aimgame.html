<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Recursive UFO Split Test</title>
  <style>
    html, body {
      margin: 0; padding: 0; overflow: hidden;
      background: black; color: white; font-family: sans-serif;
    }
    #hud {
      position: absolute; top: 10px; left: 10px; z-index: 10;
      font-size: 16px;
    }
    #overlay {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      color: white; font-size: 20px; z-index: 20;
    }
    #overlay button {
      margin-top: 20px; padding: 10px 20px;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="hud">
  UFOs Remaining: <span id="remaining">1</span>
</div>

<div id="overlay">
  <div>ðŸ‘½ UFO Reaction Challenge</div>
  <div>Click the UFO to split it â€” keep going until all are gone!</div>
  <button onclick="startGame()">Start</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas"),
      ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const hudRemaining = document.getElementById("remaining");
const overlay = document.getElementById("overlay");

let ufos = [], clicks = 0, startTime = null, endTime = null;
let reactionTimes = [];

const MAX_DEPTH = 5;
const BASE_SIZE = 100;
const IMG = new Image();
IMG.src = "ufos/ufo1.png"; // replace with your own path

class UFO {
  constructor(x, y, vx, vy, depth) {
    this.x = x;
    this.y = y;
    this.vx = vx;
    this.vy = vy;
    this.depth = depth;
    this.size = BASE_SIZE / Math.pow(1.5, depth);
    this.spawnedAt = performance.now();
  }

  update() {
    this.x += this.vx;
    this.y += this.vy;

    const r = this.size / 2;

    if (this.x - r < 0 || this.x + r > canvas.width) this.vx *= -1;
    if (this.y - r < 0 || this.y + r > canvas.height) this.vy *= -1;
  }

  draw() {
    ctx.drawImage(IMG, this.x - this.size/2, this.y - this.size/2, this.size, this.size);
  }

  hit(mx, my) {
    return Math.hypot(mx - this.x, my - this.y) < this.size / 2;
  }

  split() {
    let children = [];
    if (this.depth < MAX_DEPTH) {
      for (let i = 0; i < 2; i++) {
        let angle = Math.random() * Math.PI * 2;
        let speed = 2 + this.depth;
        let vx = Math.cos(angle) * speed;
        let vy = Math.sin(angle) * speed;
        children.push(new UFO(this.x, this.y, vx, vy, this.depth + 1));
      }
    }
    return children;
  }
}

function startGame() {
  ufos = [new UFO(canvas.width/2, canvas.height/2, 2, 2, 0)];
  clicks = 0;
  reactionTimes = [];
  startTime = null;
  endTime = null;
  overlay.style.display = "none";
  loop();
}

function endGame() {
  endTime = performance.now();
  const totalTime = ((endTime - startTime) / 1000).toFixed(2);
  const avgReaction = reactionTimes.length ? (reactionTimes.reduce((a,b)=>a+b)/reactionTimes.length).toFixed(0) : 0;

  overlay.innerHTML = `
    <div>ðŸŽ‰ All UFOs Destroyed!</div>
    <div>ðŸ•’ Total Time: ${totalTime}s</div>
    <div>ðŸ‘† Total Clicks: ${clicks}</div>
    <div>âš¡ Avg Reaction: ${avgReaction}ms</div>
    <button onclick="startGame()">Play Again</button>
  `;
  overlay.style.display = "flex";
}

function handleClick(x, y) {
  const rect = canvas.getBoundingClientRect();
  const mx = x - rect.left;
  const my = y - rect.top;

  for (let i = ufos.length - 1; i >= 0; i--) {
    if (ufos[i].hit(mx, my)) {
      const u = ufos.splice(i, 1)[0];

      if (!startTime) startTime = performance.now();
      reactionTimes.push(performance.now() - u.spawnedAt);
      clicks++;

      const children = u.split();
      ufos.push(...children);
      break;
    }
  }

  hudRemaining.innerText = ufos.length;

  if (ufos.length === 0) endGame();
}

canvas.addEventListener("click", e => handleClick(e.clientX, e.clientY));
canvas.addEventListener("touchstart", e => {
  const t = e.touches[0];
  handleClick(t.clientX, t.clientY);
});

function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ufos.forEach(u => {
    u.update();
    u.draw();
  });

  if (ufos.length > 0) {
    requestAnimationFrame(loop);
  }
}
</script>
</body>
</html>
