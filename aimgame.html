<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sudoku Game</title>
  <style>
    body {
      background: #111;
      color: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding-top: 30px;
    }
    h1 { margin-bottom: 10px; }
    table {
      border-collapse: collapse;
      border: 3px solid #fff;
    }
    td {
      width: 40px; height: 40px;
      text-align: center;
      font-size: 20px;
      border: 1px solid #555;
    }
    input {
      width: 100%;
      height: 100%;
      background: #222;
      color: white;
      text-align: center;
      border: none;
      font-size: 20px;
    }
    input:disabled {
      color: #aaa;
      background: #000;
    }
    td.block-border {
      border-right: 3px solid #fff;
      border-bottom: 3px solid #fff;
    }
    #btns {
      margin-top: 20px;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      background: #333;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #555;
    }
    #status {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Sudoku</h1>
  <table id="sudoku"></table>
  <div id="btns">
    <button onclick="checkSolution()">✅ Check</button>
    <button onclick="generateSudoku()">🔄 New Puzzle</button>
  </div>
  <div id="status"></div>

  <script>
    const sudokuTable = document.getElementById('sudoku');
    const statusDiv = document.getElementById('status');
    let puzzle = [], solution = [];

    function generateSudoku() {
      statusDiv.innerText = "";
      puzzle = generateFullBoard();
      solution = JSON.parse(JSON.stringify(puzzle));
      removeCells(puzzle, 40);
      renderBoard(puzzle);
    }

    function generateFullBoard() {
      let board = Array.from({length: 9}, () => Array(9).fill(0));

      function isValid(row, col, num) {
        for (let i = 0; i < 9; i++) {
          if (board[row][i] === num || board[i][col] === num) return false;
        }
        const r = Math.floor(row / 3) * 3, c = Math.floor(col / 3) * 3;
        for (let i = r; i < r+3; i++) {
          for (let j = c; j < c+3; j++) {
            if (board[i][j] === num) return false;
          }
        }
        return true;
      }

      function fill(r = 0, c = 0) {
        if (r === 9) return true;
        const nextR = c === 8 ? r + 1 : r;
        const nextC = c === 8 ? 0 : c + 1;
        const nums = [1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5);

        for (let n of nums) {
          if (isValid(r, c, n)) {
            board[r][c] = n;
            if (fill(nextR, nextC)) return true;
            board[r][c] = 0;
          }
        }
        return false;
      }

      fill();
      return board;
    }

    function removeCells(board, count) {
      let removed = 0;
      while (removed < count) {
        const r = Math.floor(Math.random() * 9);
        const c = Math.floor(Math.random() * 9);
        if (board[r][c] !== 0) {
          board[r][c] = 0;
          removed++;
        }
      }
    }

    function renderBoard(board) {
      sudokuTable.innerHTML = '';
      for (let r = 0; r < 9; r++) {
        const row = document.createElement('tr');
        for (let c = 0; c < 9; c++) {
          const cell = document.createElement('td');
          if ((c + 1) % 3 === 0 && c !== 8) cell.classList.add('block-border');
          if ((r + 1) % 3 === 0 && r !== 8) cell.classList.add('block-border');
          const input = document.createElement('input');
          input.setAttribute('maxlength', 1);
          if (board[r][c] !== 0) {
            input.value = board[r][c];
            input.disabled = true;
          } else {
            input.addEventListener('input', e => {
              const val = parseInt(e.target.value);
              if (isNaN(val) || val < 1 || val > 9) {
                e.target.value = '';
              }
            });
          }
          cell.appendChild(input);
          row.appendChild(cell);
        }
        sudokuTable.appendChild(row);
      }
    }

    function checkSolution() {
      const inputs = sudokuTable.getElementsByTagName('input');
      const grid = Array.from({length: 9}, () => Array(9).fill(0));
      let index = 0;
      for (let r = 0; r < 9; r++) {
        for (let c = 0; c < 9; c++) {
          grid[r][c] = parseInt(inputs[index].value) || 0;
          index++;
        }
      }

      function isValidGrid(grid) {
        const isSetValid = set => new Set(set.filter(x => x > 0)).size === 9;

        for (let i = 0; i < 9; i++) {
          const row = grid[i];
          const col = grid.map(r => r[i]);
          if (!isSetValid(row) || !isSetValid(col)) return false;
        }

        for (let r = 0; r < 9; r += 3) {
          for (let c = 0; c < 9; c += 3) {
            const block = [];
            for (let i = 0; i < 3; i++) {
              for (let j = 0; j < 3; j++) {
                block.push(grid[r+i][c+j]);
              }
            }
            if (!isSetValid(block)) return false;
          }
        }

        return true;
      }

      if (isValidGrid(grid)) {
        statusDiv.innerText = "✅ Correct! Well done.";
        statusDiv.style.color = "lightgreen";
      } else {
        statusDiv.innerText = "❌ Incorrect. Keep trying!";
        statusDiv.style.color = "orange";
      }
    }

    generateSudoku();
  </script>
</body>
</html>
